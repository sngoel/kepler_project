---
title: "STAT 380 Final Roject"
subtitle: "Spring 2019"
author: "SANCHIT GOEL"
date: "Due: 04/30/2019 11:59PM"
output: html_notebook
---

# Front matter
```{r}
# always clean up R environment
rm(list = ls())

# load all packages here
library(dplyr)
library(tidyr)
library(ggplot2)
library(caret)
library(ggplot2)
library(readr)
library(tidyverse)
library(ggthemes)
library(stringr)
library(repr)
library(plotly)
library(corrplot)
library(caTools)

# Setting a random seed
set.seed(1)
```

```{r echo = F}
# User Defined Function:
replace_drop_na <- function(arg_1) {
   arg_1[arg_1 == '-'] <- NA
   print(paste0("Pre-Cleaning Records: ", nrow(arg_1)))

  # Dropping NA values records
  result <- arg_1 %>%
  drop_na()

  print(paste0("Cleaned Records: ", nrow(result)))
  return(result)
}
```


# Loading and Cleaning the Datasets
### McDonalds Dataset
```{r echo = F}
mcd <- read.csv(file = "nutrition_facts_mcdonalds_menu.csv", header = TRUE, sep = ",")
mcd <- replace_drop_na(mcd)

# Subsetting drinks from the menu
drinks.oz <- mcd[str_detect(mcd$Serving.Size, " fl oz.*"),]
drinks.ml <- mcd[str_detect(mcd$Serving.Size, 'carton'),]

# Converting ounces to mililiters and further rounding the values
drinks.oz$Serving.Size <- 
  round(as.numeric(gsub(" fl oz.*", "", drinks.oz$Serving.Size))*29.5735, 0)
drinks.ml$Serving.Size <- 
  round(as.numeric(gsub(".*\\((.*)\\ ml).*", "\\1", drinks.ml$Serving.Size)), 0)

# Keeping the values and removing characters
food.g <- mcd[str_detect(mcd$Serving.Size, 'g'),] 
food.g$Serving.Size <- 
  round(as.numeric(gsub(".*\\((.*)\\ g).*", "\\1", food.g$Serving.Size)), 0)

# Combining drinks and food menu
# While adding a new feature for drink or food
cleaned_mcd <- rbind(drinks.oz,drinks.ml)
cleaned_mcd$Type <- rep("drinks", nrow(cleaned_mcd))
food.g$Type <- rep("food", nrow(food.g))
cleaned_mcd <- rbind(cleaned_mcd,food.g)

rm("drinks.ml", "drinks.oz", "food.g")
```

### Starbucks Food Dataset
```{r echo = F}
sbux_f <- read.csv(file = "nutrition_facts_starbucks_food_menu.csv", header = TRUE, sep = ",")
sbux_f <- replace_drop_na(sbux_f)
```

### Starbucks Drink Dataset
```{r echo = F}
sbux_d <- read.csv(file = "nutrition_facts_starbucks_drink_menu.csv", header = TRUE, sep = ",")
sbux_d <- replace_drop_na(sbux_d)
```

### Starbucks Drink Expnaded Dataset
```{r echo = F}
sbux_de <- read.csv(file = "starbucks_drink_menu_expanded.csv", header = TRUE, sep = ",")
sbux_de <- replace_drop_na(sbux_de)
```

### McDonalds Data Summary
```{r echo = F}
summary(mcd)
```

### Starbucks Food Data Summary
```{r echo = F}
summary(sbux_f)
```

### Starbucks Drink Data Summary
```{r echo = F}
summary(sbux_d)
```

### Starbucks Drink Expanded Data Summary
```{r echo = F}
summary(sbux_de)
```


## McDonalds:
#### Calories Histogram
```{r echo = F}
options(repr.plot.height = 3, repr.plot.width = 6)
ggplot(cleaned_mcd, aes(x = Calories)) +
  geom_histogram(aes(y = ..density..), fill = "lightblue", binwidth = 40, color = "darkgray") + 
  scale_x_continuous(breaks = seq(min(cleaned_mcd$Calories), max(cleaned_mcd$Calories), by = 200)) + 
  geom_density()
```

#### Calories BoxPlot
```{r echo = F}
options(repr.plot.height = 3, repr.plot.width = 6)
ggplot(cleaned_mcd, aes(x = reorder(Category, Calories), y = Calories)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = NULL)
```

#### Correlation Plot
```{r echo = F}
cr <- cor(cleaned_mcd[c(3, 4, 5, 6, 11, 13, 15, 17, 19, 20)])
corrplot(cr, method = 'color')
rm('cr')
```

#### Calories Vs Total Fat Scatter Plot
```{r echo = F}
plot(cleaned_mcd$Total.Fat, cleaned_mcd$Calories, main = "Scatter Plot", xlab = "Total Fat", ylab = "Calories")
abline(lm(cleaned_mcd$Calories~cleaned_mcd$Total.Fat))
```

#### Colries vs Protein Density Map
```{r echo = F}
options(repr.plot.height = 4, repr.plot.width = 6)
ggplot(cleaned_mcd, aes(y = Calories, x = Protein)) +
  geom_jitter(size = 1) +
  stat_density2d() +
  geom_smooth(method = 'lm', colour = 2) +
  facet_wrap( ~ Type, scales = "free_x") +
  theme(panel.border = element_rect(colour = 1, fill = NA))
```

#### Colries vs Calories from Fat Density Map
```{r echo = F}
options(repr.plot.height = 4, repr.plot.width = 6)
ggplot(cleaned_mcd, aes(y = Calories, x = Calories.from.Fat)) +
  geom_jitter(size = 1) +
  stat_density2d() +
  geom_smooth(method = 'lm', colour = 2) +
  facet_wrap( ~ Type, scales = "free_x") +
  theme(panel.border = element_rect(colour = 1, fill = NA))
```

#### Colries vs Calories from Fat Density Map
```{r echo = F}
options(repr.plot.height = 4, repr.plot.width = 6)
ggplot(cleaned_mcd, aes(y = Calories, x = Total.Fat)) +
  geom_jitter(size = 1) +
  stat_density2d() +
  geom_smooth(method = 'lm', colour = 2) +
  facet_wrap( ~ Type, scales = "free_x") +
  theme(panel.border = element_rect(colour = 1, fill = NA))
```

### Model Training
#### Splitting the dataset
```{r}
split <- sample.split(cleaned_mcd$Calories, SplitRatio = 0.80)
train <- subset(cleaned_mcd, split == "TRUE")
test <- subset(cleaned_mcd, split == "FALSE")
```

#### Linear Regression Model
```{r}
model <- lm(Calories~ Total.Fat + Protein + Carbohydrates, data = train)
summary(model)
```

#### Plots to explain the model
```{r echo = F}
plot(model, which = 1:4)
```

#### Predictions vs Actual
```{r echo = F}
predictions <- predict(model, test)
plot(test$Calories,type = "l",lty = 1.8, col="green")
lines(predictions,type = "l", col = "blue")
```

#### Future Predictions
```{r}
predict(model,data.frame(Total.Fat = 20,Protein = 18,Carbohydrates = 33))
```